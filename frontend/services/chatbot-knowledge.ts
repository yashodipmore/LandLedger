export interface FAQItem {
  id: string;
  question: string;
  answer: string;
  category: string;
  keywords: string[];
  relatedQuestions: string[];
}

export interface ChatContext {
  userRole?: 'citizen' | 'owner' | 'official';
  currentPage?: string;
  previousQuestions: string[];
  userPreferences: {
    language: string;
    detailLevel: 'basic' | 'intermediate' | 'advanced';
  };
}

export class ChatBotKnowledgeBase {
  private faqs: FAQItem[] = [
    // Platform Navigation
    {
      id: 'platform-navigation',
      question: 'How do I navigate the LandLedger platform?',
      answer: `üß≠ **LandLedger Platform Navigation Guide:**

**üè† Home Page**
‚Ä¢ Platform overview and features
‚Ä¢ Quick access to all portals
‚Ä¢ Latest updates and announcements

**üë• Citizen Portal**
‚Ä¢ Search any property in India
‚Ä¢ Verify ownership details
‚Ä¢ View property history
‚Ä¢ Download property reports
‚Ä¢ No registration required!

**ÔøΩ Owner Portal** (Registration Required)
‚Ä¢ View your property portfolio
‚Ä¢ Initiate property transfers
‚Ä¢ Upload property documents
‚Ä¢ Track transfer applications
‚Ä¢ Update property information

**üèõÔ∏è Official Portal** (Government Access)
‚Ä¢ Review transfer applications
‚Ä¢ Verify documents
‚Ä¢ Approve/reject transfers
‚Ä¢ Manage land records

**ÔøΩ Dashboard**
‚Ä¢ Real-time platform statistics
‚Ä¢ Recent activities
‚Ä¢ System performance metrics

**Quick Tip:** Start with Citizen Portal to explore without registration!`,
      category: 'navigation',
      keywords: ['navigation', 'how to use', 'platform guide', 'where to go'],
      relatedQuestions: ['How to register?', 'What can I do as citizen?', 'Where to search property?']
    },

    // Registration Process
    {
      id: 'registration-guide',
      question: 'How do I register on LandLedger?',
      answer: `ÔøΩ **Registration Process - Step by Step:**

**ÔøΩ For Property Owners:**

**Step 1: Go to Owner Portal**
‚Ä¢ Click "Owner Portal" from home page
‚Ä¢ Click "Register as Property Owner"

**Step 2: Basic Details**
‚Ä¢ Full name (as per documents)
‚Ä¢ Mobile number (OTP verification)
‚Ä¢ Email address
‚Ä¢ Create strong password

**Step 3: Identity Verification**
‚Ä¢ Upload Aadhaar card (front & back)
‚Ä¢ Upload PAN card
‚Ä¢ Take selfie for verification

**Step 4: Property Documents**
‚Ä¢ Upload property deed/sale deed
‚Ä¢ Upload mutation documents
‚Ä¢ Upload tax receipts
‚Ä¢ Add property photos

**Step 5: Verification**
‚Ä¢ Wait for government verification (3-7 days)
‚Ä¢ Receive approval notification
‚Ä¢ Start using all owner features

**üë®‚Äçüíº For Citizens:**
‚Ä¢ No registration needed for basic search
‚Ä¢ Optional registration for detailed reports

**‚è±Ô∏è Timeline:** 3-7 working days for complete verification`,
      category: 'registration',
      keywords: ['register', 'sign up', 'create account', 'how to join'],
      relatedQuestions: ['What documents needed?', 'How long verification takes?', 'Verification status?']
    },

    // Property Search Guide
    {
      id: 'property-search-detailed',
      question: 'How do I search for properties?',
      answer: `üîç **Complete Property Search Guide:**

**üìç Search Options Available:**

**1. Location-Based Search**
‚Ä¢ Enter city, area, or pincode
‚Ä¢ Use interactive map
‚Ä¢ Browse by locality

**2. Property ID Search**
‚Ä¢ Enter unique property ID
‚Ä¢ Get instant results

**3. Owner Name Search**
‚Ä¢ Search by current owner name
‚Ä¢ Find all properties of owner

**4. Survey Number Search**
‚Ä¢ Use government survey number
‚Ä¢ Official land records

**üó∫Ô∏è Using Interactive Map:**
‚Ä¢ Zoom to your area of interest
‚Ä¢ Click on property markers
‚Ä¢ View property clusters
‚Ä¢ Switch between satellite/street view

**üìã Search Results Show:**
‚Ä¢ Property location and area
‚Ä¢ Current owner details
‚Ä¢ Property type and usage
‚Ä¢ Legal status and clearances
‚Ä¢ Recent transaction history
‚Ä¢ Property valuation

**‚úÖ Verification Features:**
‚Ä¢ QR code scanning
‚Ä¢ Document authenticity check
‚Ä¢ Ownership verification
‚Ä¢ Legal status confirmation

**üí° Pro Tips:**
‚Ä¢ Use filters to narrow results
‚Ä¢ Save favorite properties
‚Ä¢ Download detailed reports
‚Ä¢ Share property links`,
      category: 'search',
      keywords: ['search property', 'find property', 'property lookup', 'how to search'],
      relatedQuestions: ['How to verify property?', 'Property information available?', 'Download property report?']
    },

    // Property Transfer Process
    {
      id: 'transfer-process-guide',
      question: 'How do I transfer property ownership?',
      answer: `üîÑ **Property Transfer Process - Complete Guide:**

**Phase 1: Initiate Transfer (Owner)**

**Step 1: Login to Owner Portal**
‚Ä¢ Access your property dashboard
‚Ä¢ Select property to transfer

**Step 2: Enter Buyer Details**
‚Ä¢ Buyer's full name
‚Ä¢ Contact information
‚Ä¢ Identity documents

**Step 3: Upload Documents**
‚Ä¢ Sale agreement draft
‚Ä¢ NOC from society/authority
‚Ä¢ Tax clearance certificates
‚Ä¢ Identity proofs (both parties)

**Step 4: Submit Application**
‚Ä¢ Review all details
‚Ä¢ Pay application fees
‚Ä¢ Submit for processing

**Phase 2: Government Review**

**Document Verification (2-3 days)**
‚Ä¢ Legal compliance check
‚Ä¢ Title verification
‚Ä¢ Encumbrance clearance

**Field Verification (3-5 days)**
‚Ä¢ Physical property inspection
‚Ä¢ Boundary verification
‚Ä¢ Neighbor confirmation

**Final Approval (1-2 days)**
‚Ä¢ Complete review
‚Ä¢ Decision notification

**Phase 3: Completion**
‚Ä¢ Digital ownership transfer
‚Ä¢ New certificates generated
‚Ä¢ All parties notified
‚Ä¢ Updated records available

**üìä Typical Timeline:** 7-15 working days
**üí∞ Fees:** ‚Çπ15,000 - ‚Çπ60,000 (vs traditional ‚Çπ50,000 - ‚Çπ2,00,000)`,
      category: 'transfer',
      keywords: ['transfer property', 'ownership change', 'property sale', 'transfer process'],
      relatedQuestions: ['Required documents?', 'Transfer fees?', 'Track application status?']
    },

    // User Roles Explained
    {
      id: 'user-roles-platform',
      question: 'What can different users do on the platform?',
      answer: `üë• **LandLedger User Roles & Capabilities:**

**ÔøΩ‚Äçüíº Citizen (No Registration Required)**
‚Ä¢ **Search Properties** - Find any property in India
‚Ä¢ **Verify Ownership** - Check current owner details
‚Ä¢ **View History** - See property transaction history
‚Ä¢ **Download Reports** - Basic property information
‚Ä¢ **QR Code Scan** - Instant property verification
‚Ä¢ **Map Exploration** - Browse properties on map

**üè† Property Owner (Registration Required)**
‚Ä¢ **Portfolio Management** - View all owned properties
‚Ä¢ **Transfer Initiation** - Start property sale process
‚Ä¢ **Document Upload** - Add property documents
‚Ä¢ **Application Tracking** - Monitor transfer status
‚Ä¢ **Property Updates** - Modify property details
‚Ä¢ **Valuation Reports** - Get property assessments
‚Ä¢ **Notification Center** - Receive important updates

**üèõÔ∏è Government Official (Official Access)**
‚Ä¢ **Application Review** - Process transfer requests
‚Ä¢ **Document Verification** - Validate submitted documents
‚Ä¢ **Field Inspection** - Conduct property verification
‚Ä¢ **Approval Authority** - Approve/reject applications
‚Ä¢ **Record Management** - Update official records
‚Ä¢ **Dispute Resolution** - Handle property disputes

**üîê Access Levels:**
‚Ä¢ Citizen: Public access (no login needed)
‚Ä¢ Owner: Verified access (documents required)
‚Ä¢ Official: Government credentials required`,
      category: 'roles',
      keywords: ['user roles', 'what can I do', 'permissions', 'access levels'],
      relatedQuestions: ['How to become owner?', 'Citizen registration needed?', 'Official access process?']
    },

    // Platform Features
    {
      id: 'platform-features',
      question: 'What are the main features of LandLedger?',
      answer: `‚≠ê **LandLedger Platform Features:**

**üîç Smart Property Search**
‚Ä¢ Advanced search filters
‚Ä¢ Interactive map interface
‚Ä¢ Real-time property data
‚Ä¢ Multiple search criteria
‚Ä¢ Instant results

**‚úÖ Property Verification**
‚Ä¢ QR code scanning
‚Ä¢ Digital certificates
‚Ä¢ Ownership authentication
‚Ä¢ Legal status check
‚Ä¢ History verification

**üìã Digital Documentation**
‚Ä¢ Document upload system
‚Ä¢ Digital signatures
‚Ä¢ Secure storage
‚Ä¢ Easy sharing
‚Ä¢ Version control

**üîÑ Transfer Management**
‚Ä¢ Online application system
‚Ä¢ Status tracking
‚Ä¢ Automated notifications
‚Ä¢ Digital approvals
‚Ä¢ Instant updates

**üìä Analytics Dashboard**
‚Ä¢ Property statistics
‚Ä¢ Market trends
‚Ä¢ Transaction analytics
‚Ä¢ Performance metrics
‚Ä¢ Real-time data

**ÔøΩ Mobile Responsive**
‚Ä¢ Works on all devices
‚Ä¢ Mobile-friendly interface
‚Ä¢ Touch-optimized
‚Ä¢ Offline QR scanning
‚Ä¢ App-like experience

**üîí Security Features**
‚Ä¢ Secure authentication
‚Ä¢ Data encryption
‚Ä¢ Privacy protection
‚Ä¢ Audit trails
‚Ä¢ Backup systems

**üåê Accessibility**
‚Ä¢ Multi-language support
‚Ä¢ Simple interface
‚Ä¢ Help documentation
‚Ä¢ 24/7 availability
‚Ä¢ Cross-browser compatibility`,
      category: 'features',
      keywords: ['features', 'what does it do', 'capabilities', 'platform functions'],
      relatedQuestions: ['How secure is platform?', 'Mobile app available?', 'Language support?']
    },

    // Troubleshooting
    {
      id: 'troubleshooting-guide',
      question: 'I am facing issues with the platform, how to get help?',
      answer: `üõ†Ô∏è **LandLedger Support & Troubleshooting:**

**ÔøΩ Common Issues & Solutions:**

**Login Problems**
‚Ä¢ Clear browser cache and cookies
‚Ä¢ Try different browser
‚Ä¢ Check internet connection
‚Ä¢ Reset password if needed

**Document Upload Issues**
‚Ä¢ Use supported formats (JPG, PNG, PDF)
‚Ä¢ Check file size (max 10MB)
‚Ä¢ Ensure clear, readable documents
‚Ä¢ Try different browser

**Search Not Working**
‚Ä¢ Check spelling of search terms
‚Ä¢ Try different search criteria
‚Ä¢ Use map search as alternative
‚Ä¢ Refresh page and try again

**Slow Performance**
‚Ä¢ Check internet speed
‚Ä¢ Clear browser cache
‚Ä¢ Close other browser tabs
‚Ä¢ Try different device

**üìû Get Help:**

**24/7 Live Chat**
‚Ä¢ Click chat icon (bottom-right)
‚Ä¢ Instant assistance available
‚Ä¢ Technical support included

**Phone Support**
‚Ä¢ Call: +91-9876543210
‚Ä¢ Hours: 9 AM - 9 PM IST
‚Ä¢ Regional language support

**Email Support**
‚Ä¢ Email: support@landledger.com
‚Ä¢ Response within 4 hours
‚Ä¢ Detailed issue resolution

**Help Center**
‚Ä¢ Video tutorials available
‚Ä¢ Step-by-step guides
‚Ä¢ FAQ database
‚Ä¢ User manual download

**ÔøΩ Training Resources**
‚Ä¢ Free webinar sessions
‚Ä¢ Interactive tutorials
‚Ä¢ Practice environment
‚Ä¢ Certification courses`,
      category: 'support',
      keywords: ['help', 'support', 'issues', 'problems', 'troubleshooting'],
      relatedQuestions: ['Contact support?', 'Training available?', 'Common problems?']
    }
  ];

  // Smart search algorithm
  findRelevantAnswer(query: string, context?: ChatContext): string {
    const normalizedQuery = query.toLowerCase().trim();
    
    // Direct keyword matching
    for (const faq of this.faqs) {
      for (const keyword of faq.keywords) {
        if (normalizedQuery.includes(keyword.toLowerCase())) {
          return this.formatAnswer(faq, context);
        }
      }
    }

    // Fuzzy matching for questions
    for (const faq of this.faqs) {
      const questionWords = faq.question.toLowerCase().split(' ');
      const queryWords = normalizedQuery.split(' ');
      
      const matchScore = this.calculateMatchScore(questionWords, queryWords);
      if (matchScore > 0.6) {
        return this.formatAnswer(faq, context);
      }
    }

    // Context-based responses
    if (context?.currentPage) {
      return this.getContextualResponse(normalizedQuery, context);
    }

    // Default fallback
    return this.getDefaultResponse(normalizedQuery);
  }

  private calculateMatchScore(words1: string[], words2: string[]): number {
    let matches = 0;
    for (const word1 of words1) {
      for (const word2 of words2) {
        if (word1.includes(word2) || word2.includes(word1)) {
          matches++;
          break;
        }
      }
    }
    return matches / Math.max(words1.length, words2.length);
  }

  private formatAnswer(faq: FAQItem, context?: ChatContext): string {
    let answer = faq.answer;
    
    // Customize based on user role
    if (context?.userRole) {
      switch (context.userRole) {
        case 'citizen':
          answer += "\n\nüí° **As a citizen**, you have full access to property search and verification features without registration!";
          break;
        case 'owner':
          answer += "\n\nüè† **As a property owner**, you can access advanced features like transfer initiation and portfolio management.";
          break;
        case 'official':
          answer += "\n\nüèõÔ∏è **As a government official**, you have administrative access to verify and approve transactions.";
          break;
      }
    }

    return answer;
  }

  private getContextualResponse(query: string, context: ChatContext): string {
    const page = context.currentPage;
    
    if (page === 'citizen' && query.includes('search')) {
      return "üîç **You're on the Citizen Portal!** Perfect for property search. Use the search bar above to find properties by location, owner name, or property ID. You can also click on the interactive map to explore properties in specific areas.";
    }
    
    if (page === 'dashboard' && query.includes('statistics')) {
      return "üìä **Dashboard Analytics:** You can see real-time statistics including total properties registered, transfers completed, success rates, and platform activity. The charts update automatically with the latest data.";
    }
    
    return this.getDefaultResponse(query);
  }

  private getDefaultResponse(query: string): string {
    const responses = [
      "ü§î I'd love to help you with that! Could you be more specific about what you'd like to know regarding:",
      "üí° I'm here to assist! Let me help you understand more about:",
      "üîç I can provide information on various topics. Would you like to know more about:"
    ];
    
    const topics = [
      "‚Ä¢ **Platform Features** - How LandLedger works",
      "‚Ä¢ **Blockchain Technology** - Security and transparency", 
      "‚Ä¢ **Property Search** - Finding and verifying properties",
      "‚Ä¢ **Transfer Process** - How to transfer property ownership",
      "‚Ä¢ **User Roles** - Different types of users and their permissions",
      "‚Ä¢ **Getting Started** - Registration and onboarding process"
    ];
    
    const randomResponse = responses[Math.floor(Math.random() * responses.length)];
    return `${randomResponse}\n\n${topics.join('\n')}\n\nTry asking about any of these topics or use the quick action buttons above!`;
  }

  // Get suggestions based on current conversation
  getSuggestions(query: string, context?: ChatContext): string[] {
    const suggestions = [
      "What is blockchain technology?",
      "How do I search for properties?",
      "What are the benefits of LandLedger?",
      "How does property transfer work?",
      "What documents do I need?",
      "Is the platform secure?",
      "How to get started?",
      "Who can use this platform?"
    ];

    // Randomize and return 3 suggestions
    return suggestions.sort(() => 0.5 - Math.random()).slice(0, 3);
  }

  // Get FAQ by category for quick actions
  getFAQsByCategory(category: string): FAQItem[] {
    return this.faqs.filter(faq => faq.category === category);
  }
}

export const knowledgeBase = new ChatBotKnowledgeBase();
